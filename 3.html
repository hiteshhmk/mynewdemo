<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Attendance System</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script>
const officeLat = 23.021589; // Praxware office latitude
const officeLng = 72.541687; // Praxware office longitude
const maxDistance = 0.1; // 100

function getDistance(lat1, lon1, lat2, lon2){
  const R = 6371;
  const dLat = (lat2-lat1)*Math.PI/180;
  const dLon = (lon2-lon1)*Math.PI/180;
  const a = Math.sin(dLat/2)**2 +
            Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180) *
            Math.sin(dLon/2)**2;
  return R*2*Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}

function markAttendance(type){
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos=>{
      let dist = getDistance(officeLat,officeLng,pos.coords.latitude,pos.coords.longitude);
      if(dist <= maxDistance){
        fetch('save_attendance.php',{
          method:'POST',
          headers:{'Content-Type':'application/x-www-form-urlencoded'},
          body:`type=${type}&lat=${pos.coords.latitude}&lng=${pos.coords.longitude}`
        }).then(r=>r.text()).then(alert);
      }else{
        alert("You are not at the Praxware office location.\nAttendance can only be marked at the office.");
      }
    });
  }else{
    alert("Geolocation not supported on your device.");
  }
}
</script>
</head>
<body class="p-4">
<h2 class="mb-4">Attendance</h2>
<button class="btn btn-success me-3" onclick="markAttendance('in')">Mark IN</button>
<button class="btn btn-danger" onclick="markAttendance('out')">Mark OUT</button>
</body>
</html>
